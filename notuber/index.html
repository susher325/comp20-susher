<!DOCTYPE html>
<html>

<head>
	<title> Not Uber </title>
	<meta charset="utf-8"/>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="https://maps.google.com/maps/api/js?key=AIzaSyC6R-eGHnlr79RuOKwz29qKSz52XP3LM4g" async defer></script> 
</head>

<body onload="initMap()">
	<h1> NOT UBER </h1>
	<div id="map"></div>

	<script>

		var myPos;

		function initMap() {
			//initiate map		
				map = new google.maps.Map(document.getElementById('map'), { 
				center: {lat: 42.4075, lng: -71.1190},
				zoom: 15 });

			if (navigator.geolocation){
				navigator.geolocation.getCurrentPosition(function(position) {
					myPos = { lat: position.coords.latitude, lng: position.coords.longitude};
					updateLocation();
				});
			}
			else {
				alert("Geolocation is not supported by your web browser");
			}
		}

		function updateLocation(){
			//move to current location
			map.panTo(myPos);
			myMarker = new google.maps.Marker({
				position: myPos,
				icon: 'myIcon.png',
				title: 	"Username: " + username + "<br/> Calculating distance to closest passenger..."
			});

			infowindow = new google.maps.InfoWindow();

			google.maps.event.addListener(myMarker,'click', function(){
				infowindow.setContent(myMarker.title);
				infowindow.open(map,myMarker);
			});

			myMarker.setMap(map);
			loadPassengers();
		}

		function loadPassengers() {
			//Step 1: Create instance of XMLHttpRequest
			request = new XMLHttpRequest();

			//Step 2: Set up an HTTP response
			request.open("POST", "https://jordan-marsh.herokuapp.com/rides", true);
			request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

			//Step 3: Set up to handle the HTTP response
			request.onreadystatechange = function(){
				if (request.readyState == 4 && request.status == 200) {

					//Step 5: Work with response data
					information = request.responseText;
					parsedInfo = JSON.parse(information);

					//determine if working with vehicle or passenger
					if (typeof parsedInfo.passengers === undefined){
						data = parsedInfo.vehicles;
						userIcon='carIcon.png';
					} else {
						data = parsedInfo.passengers;
						userIcon='passenger.png';
					}
				}

			//Step 4: Trigger HTTP Request
			request.send("username=" + username + "&lat=" + myPos.lat + "&lng=" + myPos.lng);
		}
	</script>
</body>
</html>